
Understanding Authentication & Authorization in kubernetes

# USER run these commands in Workstation
# Create a private key 
$ openssl genrsa -out krishna.key 2048

# Create CSR file
$ openssl req -new -key krishna.key -out user1.csr -subj "/CN=krishna/O=prod"

# How to send a CSR file to CA (Master Admin or K8s admin)
- Send via manual way eg. email
- csr api

# Admin run these commands in Workstation
$ openssl x509 -req -in krishna.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out krishna.crt -days 500

# Admin would send user1.crt to USER.
- Send via manual way eg. email 
- csr api - they can download self
===========================================
useradd -m krishna

mkdir -p /home/krishna/.kube

================================
kubectl config
==================================================================================================

apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0F
    server: https://192.168.1.114:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    namespace: prod
    user: krishna
  name: prod-context
current-context: prod-context
kind: Config
preferences: {}
users:
- name: krishna
  user:
    client-certificate: /home/krishna/.kube/krishna.crt
    client-key: /home/krishna/.kube/krishna.key

$ kubectl config view

$ kubectl config set-context user1-context --cluster=kubernetes --namespace=office --user=user1

$ kubectl config view

$ kubectl create namespace office

$kubectl --context=user1-context get pods

# kubectl --context=user1-context get pods
Error from server (Forbidden): pods is forbidden: User "employee" cannot list resource "pods" in API group "" in the namespace "office"
# Only we have enabled employee authentication. He has no rights on K8s.



kubectl version --short

krishna@ip-192-168-1-114:~/.kube$ kubectl version --short
Flag --short has been deprecated, and will be removed in the future. The --short output will become the default.
Client Version: v1.27.3
Kustomize Version: v5.0.1
Server Version: v1.27.3
krishna@ip-192-168-1-114:~/.kube$ kubectl get pods -n prod
No resources found in prod namespace.
krishna@ip-192-168-1-114:~/.kube$ vim config
krishna@ip-192-168-1-114:~/.kube$



